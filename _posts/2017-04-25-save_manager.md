---
layout: post
title: "操作系统之设备管理"
catalog: true
date: 2017-04-25
tags:
    - 基础
---
操作系统设备管理，设备管理的主要对像是I/O设备，所以这一篇主要介绍的还是I/O系统与硬盘，先说说I/O设备有哪些类型，按照不同的分类标准有不同的类别，按照设备的使用特性分为存储设备和输入/输出设备，按照传输速率分为三类低速设备，中速设备和高速设备（磁盘磁带），按照信息交换单位分为块设备（数据块为单位eg.磁盘，速度快），字符设备（种类多，速度慢eg.打印机），按照设备的共享属性分为独占设备和共享设备还有虚拟设备，虚拟设备是将一台独占设备变换成几台逻辑设备，供若干进程同时使用。设备是不能与CPU进行通信的，通常是与设备控制哭喊通信，因此I/O设备应该含有与设备控制器间的接口，在接口中有三种信号数据信号， 状态信号，控制信号，说到设备控制器了，我们就说说设备控制器的功能第一：接收和识别命令（控制寄存器和命令译码器）第二：数据交换（设备与控制器，控制器与CPU）,第三：标识和报告设备的状态（控制器保存设备的状态，只有就绪了CPU才启动控制器），第四：地址识别（系统中的每个设备都应该像内存一样有地址，地址译码器）第五：数据缓冲（控制器中有缓冲），第六：差错控制（对传输校验，如果错误cpu重新发）。设备控制器的组成 ：设备控制器与处理机的接口（数据线，地址线，控制线），设备控制器与设备接口（一个控制器连接多个设备，每个设备都有对应的上面三种线）， I/O逻辑（实现对设备的控制，它通过一组控制线与处理机交互，处理利用逻辑向控制器发I/O命令，由控制器的I/O逻辑进行地址译码）<!--more-->
为了进一步减轻CPU负担引入了I/O通道， I/O通道是一个特殊的处理机，CPU只需要向通过发一条通道指令，他会自动在内存里找到相应的程序进行执行，直到完成然后就中断CPU,由于设备的多样性造成了通道的多样性：字节多路通道（有许多小通道（与每个设备相连接）和一个主通道，采用交叉方式工作）， 数组选择通道（适合高速设备，利用率低，只有一个通道，有可能出现一直独占）， 数组多路通道（前两者的结合），由于通道价格贵所以不可能如上面说的一个控制器一个通道的情况了，所以采取的方法是一个通道与所有控制器连接，一个控制器与多个设备连接，这样就不用一个设备一个控制器的问题了
### I/O控制方式
1. 程序I/O方式:处理机像I/O设备发出指令后，会一直循环测试寄存器里的状态变化
2. 中断驱动I/O控制方式：以字节为单位，当传输完一个的时候就要发通过控制器中断一次，虽然I/O与处理机并行了，但是效率还是有点低
3. 直接存储器访问（DMA）I/O控制方式：前面的两种非常不适合块设备的I/O操作，这个DMA有以下特点第一：传输基本单位是数据块，每次至少一个数据块，第二，传输的东西直接进入内存或者内存进入设备，第三：只有传输的开始和结束才会有中断CPU.   DMA控制器的组成：主机与DMA控制器接口，DMA控制器与块设备的接口，以及I/O控制逻辑。DMA控制器中应该有四类寄存器：命令/状态寄存器，内存地址寄存器，数据寄存器，数据计数器（CPU要读取的字节数）![](/images/2017/0424dma.jpg)DMA的工作过程：和前面说的差不多就是把命令放在了相应的寄存器，然后传数据直到传完，给CPU中断
4. I/O通道控制方式 它的引入为了解决多个数据块的问题，因为一个数据块读完还是会发现CPU中断的如果我们有数百个数据块就得发出数百次的中断。他是以记录为单位的。通道控制方式，是通过通道程序来完成的，通道程序有以下几个东西。a.操作码（读写，控制等）b. 内存地址（要送入什么地址）c.计数 d. 通道程序结束位P。 e.记录程序结束位R(表示本通道指令与下一条指令所处理的数据是同属于一个记录)

### 缓冲管理
单缓冲 /双缓冲 \循环缓冲
### I/O软件
设计目标，a. 与具体设备无关， b.统一命名， c.对错误的处理。 4.缓冲技术， 5. 设备的分配和释放（多用户可能死锁） 6。I/O控制方式
I/O层次： 用户层软件 ， 设备独立性软件， 设备驱动程序， 中断处理程序， 硬件
### 设备分配
### 磁盘存储的管理
